\documentclass[titlepage, twocolumn, a4paper, 12pt]{article}
\usepackage[swedish]{babel}
\usepackage[utf8]{inputenc}
\usepackage{verbatim}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{parskip}
\usepackage{enumerate}

% SourceCode
\usepackage{listings}
\usepackage{color}

% Include pdf with multiple pages ex \includepdf[pages=-, nup=2x2]{filename.pdf}
\usepackage[final]{pdfpages}
% Place figures where they should be
\usepackage{float}

% SourceCode
\definecolor{keywordcolor}{rgb}{0.5,0,0.75}
\lstset{
  inputencoding=utf8,
  language=Java,
  extendedchars=true,
  basicstyle=\scriptsize\ttfamily,
  stringstyle=\color{blue},
  commentstyle=\color{red},
  numbers=left,
  firstnumber=auto,
  numberblanklines=true,
  stepnumber=1,
  showstringspaces=false,
  keywordstyle=\color{keywordcolor}
  % identifierstyle=\color{identifiercolor}
}

% Float for text
\floatstyle{ruled}
\newfloat{kod}{H}{lop}
\floatname{kod}{Kodsnutt}

% vars
\def\title{Genetisk animation; rörelsemönster i 2D mha neuralt nät och genetisk algoritm}
\def\preTitle{Projekt}
\def\kurs{Emergenta system, 5DV017}
\def\namn{Andreas Jakobsson}
\def\mail{dit06ajs@cs.umu.se}

\def\namnTva{Anton Johansson}
\def\mailTva{dit06ajn@cs.umu.se}

\def\namnTre{Erik Rönnberg}
\def\mailTre{dit06erg@cs.umu.se}

\def\namnFyra{Ludvig Widman}
\def\mailFyra{dit06lwn@cs.umu.se}

\def\namnFem{Ragnar Asplund}
\def\mailFem{dit04rad@cs.umu.se}

\def\pathtocode{$\sim$dit06ajn/edu/emergenta-system/projektet/src}

\def\handledareEtt{Jonny Pettersson, jonny@cs.umu.se}
\def\handledareTva{Anders Broberg, bopspe@cs.umu.se}

\def\inst{datavetenskap}
\def\dokumentTyp{Projektrapport}

\begin{document}
\begin{titlepage}
  \thispagestyle{empty}
  \begin{small}
    \begin{tabular}{@{}p{\textwidth}@{}}
      UMEÅ UNIVERSITET \hfill \today \\
      Institutionen för \inst \\
      \dokumentTyp \\
    \end{tabular}
  \end{small}
  \vspace{10mm}
  \begin{center}
    \LARGE{\preTitle} \\
    \huge{\textbf{\kurs}} \\
    \vspace{10mm}
    \LARGE{\title} \\
    \vspace{15mm}
    \begin{large}
      \namn, \mail \\
      \namnTva, \mailTva\\
      \namnTre, \mailTre\\
      \namnFyra, \mailFyra\\
      \namnFem, \mailFem\\
      \texttt{\pathtocode}
    \end{large}
    \vfill
    \large{\textbf{Handledare}}\\
    \mbox{\large{\handledareEtt}}
    \mbox{\large{\handledareTva}}
  \end{center}
\end{titlepage}

\newpage
\mbox{}
\vspace{70mm}
\begin{center}
% Dedication goes here
\end{center}
\thispagestyle{empty}
\newpage

\pagestyle{fancy}
\rhead{\today}
\lhead{\footnotesize{\mail, \mailTva\\\mailTre, \mailFyra, \mailFem}}
\chead{}
\lfoot{}
\cfoot{}
\rfoot{}

\begin{abstract}
% TODO: Sammanfattning/abstract

\end{abstract}

\cleardoublepage
\newpage
\tableofcontents
\cleardoublepage

\cfoot{\thepage}
\pagenumbering{arabic}

\section{Frågeställning}
Kan vi återskapa Sims Rapport? WWKSD? What whould Karl Sims do? Bigup!


Abstract Sammanfattning
Introduction Introduktion
    - Några tidigare studierd
    - Frågeställning/Syfte
    - Vad vi har gjort
Creature Control Kontroll av varelser
  - Sensorer
  - Effektorer (diff på Sims)
  - Neuroner
  
Physical simulation
Behavior Selection
Results
Future Work
Conclusions
Acknowledgements
    - Sims Gud Karl



\section{Introduktion}
% Introduktion till ämnet, inklusive översikt av tidigare studier
% \cite{flake}

I detta projekt har vi undersökt möjligheten att utveckla rörelsemönster för en enkel varelse med hjälp av genetiska algoritmer. Varelsen har ett neuralt nät som ”hjärna” och har formen av en ledad ”mask”.

\subsection{Karl Sims}
Karl Sims utforskar i Evolving Virtual Creatures \cite{sims} både hur varelsers form och deras beteenden kan utvecklas med hjälp av genetiska algoritmer (GA). Varelserna har sensorer och effektorer som är kopplade till in- och utnoder i ett neuralt nät. 

I sina försök använder Sims en GA för att optimera både struktur och vikter i det neurala nätet. Det nät han använder har i varje nod en av många matematiska funktioner; exempelvis sinus, summa, produkt, max, osv. Sims lät sina försök köra mellan 50 och 100 generationer och optimerade mot olika typer av beteenden som ex gång, simmande och hoppande rörelser. 

\subsection{Hugo de Garis}
Hugo de Garis forskning i \textit{GENETIC PROGRAMMING Evolutionary Approaches to Multistrategy Learning} \cite{garis} inriktar sig i störst utsträckning mot utveckling av hårdvara med hjälp av genetiska algoritmer. Han beskriver metoder som shaping (att i olika steg ändra definitionen för fitness) och talar om "utvecklingsbara system" med de avseendet att vissa system inte går att ge önskvärt beteende med hjälp av genetiska algoritmer. Han nämner att de inte finns något sätt att definitivt avgöra vilka system som är utvecklingsbara med fasta kriterier.

Garis har utvecklat en simulerad ödla som han kallar LIZZY \cite{garis}. LIZZY känner sin omvärld med två antenner och tar därigenom emot karaktäristiska signaler från tre sorters kreatur i dess omgivning; Mate, Prey och Predator. Med hjälp av ett neuralt nät och en genetisk algoritm lär sig sedan LIZZY att söka upp Prey och Mate, där vidta passande åtgärder, och att fly undan Predators.

\subsection{Syfte}
% Frågeställning fylls i här typ

Kan en GA hitta ett naturligt rörelsemönster för ett enkelt 2d-djur? 
Hur effektiva är GAs på att hitta fungerande rörelsemönster? 
Kan vi upprepa Browns, Nicolas Lassabe eller Karl Sims simuleringar i en 
2D-miljö? 

Alt1. 


\section{Metodbeskrivning, Vad vi har gjort}
% Metodbeskrivning. Ska beskrivas så utförligt att läsaren ska kunna
% reproducera ert arbete
% Systemet består av tre stora delar. Den genetiska algoritmen (GA), Hjärnan och Fysiksimuleringen. 
Vi har utvecklat ett system som utvecklar kroppars rörelsemönster med hjälp av en genetisk algoritm. Kroppens rörelse bestäms av ett neuralt nät och simuleras i en fysikmotor.
% Alltid en början av en början...


\subsection{Kontroll av varelser}
\subsubsection{Sensorer}
% Bodies, getXposiotion() typ!!!!! <<<<<<< typ jag skrev typ
%VADÅ TYP

%for (int i = 0, length = inputs.length; i < length; i++) {
%            float b1 = bodyList.get(i).getPosition().getY();
%            float b2 = bodyList.get(i+1).getPosition().getY();
%            inputs[i] = b1-b2;
%}
        
%EXAKT!

\subsubsection{Effektorer}
% Joints

\subsubsection{Neuralt nät}
% Neuroner
Varelsens hjärna består av ett neuralt nät som styr dess beteende. Det neurala nätet är vagt implementerat enligt Hopfields modell för neurala nät, se kapitel 13 i boken \textit{Neural networks: a systematic introduction}, se \cite{raul}. Varje nod i det neurala nätet har bågar till och från alla andra noder. Varje båge har en vikt.

För att mata nätet med indata tas värden emot och körs genom en sigmoid funktion $1/\frac{1}{e^{-x}}$. Denna funktion är modifierad för att ge resultat mellan -1 och 1. Javakod som körs visas i kodsnutt \ref{kod:sigmoid}

\begin{kod}
\begin{footnotesize}
\begin{verbatim}
2 / (1 + Math.pow(Math.E, (-2 * x))) - 1
\end{verbatim}
\end{footnotesize}
\caption{Sigmoid (java)}\label{kod:sigmoid}
\end{kod}

Vid varje simuleringssteg i hjärnan beräknas ett värde i varje nod. Värdet beräknas som en summa av värdet från varje båge gånger dess vikt. På denna summa appliceras sedan sigmoidfunktionen så värdet hamnar mellan -1 och 1.

\begin{figure}[H]
  \begin{center}
    \includegraphics[width=78mm]{images/neuralnet.pdf}
    \caption{Neuralt nätverk med två noder}
    \label{fig:neuralnet.pdf}
  \end{center}
\end{figure}

%tänkte mig lista klasser här så det blir en systemöversikt? 
%\begin{enumerate}[(a)]
%\item ...  ...
%\item hej
%\end{enumerate}

\subsection{Simulering}
Fysiksimuleringen använder biblioteket \textit{phys2d} \cite{phys2d} för själva fysiken. Detta bibliotek är skrivet av Kevin Glass och är en Java-portning av Erin Catto's plattform \textit{box2d} \cite{box2d}. Denna platform valdes på grund av att den bygger på Java och gruppen besitter kompetens inom språket. I simuleringen har ett markplan skapats och på detta en varelse. 

Varelsen består av en mask med 4 leder och 5 kroppsdelar. Varje led kan röra sig 180 grader. Varje kroppsdel har en sensor som ger \textit{hjärnan} indata om dess y-position i förhållande till delen utmed. Att en maskliknande varelse har valts beror på att kroppen är relativ enkel i sin sammansättning och komplexiteten sjunker således. Kroppsdelarnas vikt, ledernas typ och ledernas rörelsefrihet har valts efter eget tycke då varelsen ses som ett inledande exempel på hur systemet kan fungera. Valet av indata för varelsen grundas i en önskan om ledernas vetskap om varandra.


\subsection{Genetisk algoritm}
För selektion används en variant på tournament selection. Två grupper om tre individer väljs slumpmässigt och de med högst fitness ur respektive grupp korsas så två nya varelser med en blandning av deras genotyp skapas. Detta upprepas tills en bestämd del av en ny population har skapats. Därefter väljs fler grupper av tre där de bästa direkt går till den nya populationen oförändrade tills den nya populationen har samma storlek som den gamla. Varje individ i den nya populationen muterar varje del av sin genotyp med en viss sannolikhet. Den nya populationen ersätter därefter den gamla. 
		
Genotypen i varelsen kodar för vikter i det neurala nät som utgör dess hjärna. För att evaluera fitness för varje individ skapas ett nät med de vikter genotypen anger, detta får sedan under en begränsad tid styra en fast kropp i en fysiksimulering. Fitness beräknas på hur långt kroppen lyckats röra sig.

\section{Resultat}
% Resultat innehållande sammanställning/analys av tester
\begin{figure}
    \includegraphics[width=78mm]{images/mask1_gs.png}
\end{figure}

\begin{figure}
    \includegraphics[width=78mm]{images/maskninja.png}
\end{figure}

-34.6358039855957	-5.2322540283203125
-18.24432830810547	39.70292663574219
-14.486499786376953	39.70220947265625
-3.3265899658203124	61.23805236816406
-9.420597076416016	80.82241821289062
-2.541945608038651	87.39546203613281
3.548807480755974	81.83610534667969
8.633655124240452	100.64521789550781


-25.854436492919923	63.74101257324219
-13.107375335693359	70.67256164550781
-9.300043487548828	81.12055969238281
-28.86897679379112	38.43251037597656
13.848107874393463	239.08647847175598
-28.59629652374669	237.60971236228943
4.116374003887176	237.597829580307
1.4083959221839906	365.5415802001953
16.758824398643092	498.77978515625
9.69740210639106	498.6872253417969
24.18791439658717	498.21331787109375
7.5698699951171875	492.76136779785156
-2.252584357010691	492.7564392089844
-4.965674149362664	492.75433349609375
48.45077048407661	485.5240478515625
14.223643654271177	485.52587890625
36.00650872124566	575.3929138183594
48.08240852355957	576.4092712402344
10.025600051879882	576.4110107421875
44.0106450131065	576.4188842773438

\section{Diskussion}
% Diskussion av resultatet, koppling till tidigare studier

\bibliographystyle{alpha}
\bibliography{books}

\newpage
\appendix
\pagenumbering{roman}
\section{Källkod}\label{sec:kallkod}
Härefter följer utskrifter från källkoden och andra filer som hör till
denna laboration.

\subsection{Flocking.nlogo}\label{app:Flocking.nlogo}
\begin{footnotesize}
  \verbatiminput{../src/Flocking.nlogo}
\end{footnotesize}
\end{document}
